# Database

To get an instance of the database client, import the `connect_database.py` module, and call
the `get_database_client()` method:

```python
import connect_database

client = connect_database.get_database_client()

result = client.execute("SELECT * FROM transactions").all()
```

## Schema

### Classification table

##### Definitions

| Column name | Data type |
| ----------- | --------- |
| shop_name   | text      |
| category    | text      |
| occurances  | int       |

Primary key (shop_name, category)

##### Example data

| shop_name    | category | occurances |
| ------------ | -------- | ---------- |
| Morrisons    | food     | 1          |
| ASDA         | food     | 1          |
| River Island | clothing | 1          |

```python
client.execute(
    "INSERT INTO fisci.classification (shop_name, category, occurances) VALUES ('Tesco', 'food', 1);")
```

Always keep the category name in lower case, to prevent duplicates

Occurances should be incremented each time the data is manually labeled.

### Transaction table

##### Definitions

| Column name    | Data type | Description                                                        |
| -------------- | --------- | ------------------------------------------------------------------ |
| transaction_id | timeuuid  | always pass the `now()` function to this value (see example)       |
| user_id        | text      | The user id is generated by firebase                               |
| shop_name      | text      |
| category       | text      | Always keep the category name in lower case, to prevent duplicates |
| labeled        | boolean   | true if the category has been labeled by a human                   |
| amount         | float     |
| date           | date      | the transaction date in the form 'yyyy-mm-dd'                      |

Primary key (transaction_id)

##### Example data

| transaction_id                       | amount | category | date       | labeled | shop_name | user_id |
| ------------------------------------ | ------ | -------- | ---------- | ------- | --------- | ------- |
| dd178b20-5dba-11eb-9ddb-cfe6a86cc440 | 50.5   | food     | 2020-12-19 | True    | Tesco     | userid  |

```python
client.execute(
    "INSERT INTO fisci.transactions (transaction_id, user_id, shop_name, category, labeled, amount, date) VALUES (now(), 'userid', 'Tesco', 'food', true, 50.5, '2020-12-19');")
```
